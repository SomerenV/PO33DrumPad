<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PO-33 Drum Pad</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ryanoasis/nerd-fonts@master/patched-fonts/3270/Regular/3270-Regular.css">

<style>
* { box-sizing: border-box; font-family: "3270 Nerd Font", monospace; }
body {
  background:#0d0d0d; color:#e0e0e0;
  display:flex; flex-direction:column; align-items:center;
  padding:20px;
}
h1 { font-size:50px; margin-bottom:12px; }

.buttons {
  display:flex; flex-wrap:wrap; gap:6px; justify-content:center;
  margin-bottom:14px;
}
button {
  background:#111; color:#e0e0e0;
  border:1px solid #444;
  padding:8px 14px;
  font-size:22px; font-weight:bold;
  cursor:pointer;
}
button.selected { background:#fff; color:#000; }
button:disabled { opacity:0.6; }

.grid {
  display:grid;
  grid-template-columns:repeat(4,200px);
  gap:10px;
  margin-bottom:16px;
}

.pad {
  width:200px; height:200px;
  background:#111;
  border:1px dashed #444;
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  cursor:pointer;
  white-space:pre-line;
  font-size:22px;
  user-select:none;
}
.pad.loaded { background:#181818; border-style:solid; }
.pad.playing { background:#00ff66; color:#000; }

.rate {
  position:absolute;
  top:6px; left:6px;
  font-size:16px;
  opacity:0.85;
}

.controls {
  display:flex;
  gap:12px;
  align-items:center;
  flex-wrap:wrap;
}

input {
  background:#111;
  color:#fff;
  border:1px solid #444;
  font-size:22px;
  padding:4px 8px;
  width:100px;
  text-align:center;
}
label {
  display:flex;
  gap:6px;
  align-items:center;
  font-size:18px;
}
</style>
</head>
<body>

<h1>PO-33 DRUM PAD</h1>

<div class="buttons" id="genreButtons"></div>

<div class="grid" id="grid"></div>

<div class="controls">
  <button id="playSequence">Play All</button>

  <label>
    Cutoff (ms)
    <input id="cutoffInput" type="number" value="0" min="0">
  </label>

  <label>
    Gap (ms)
    <input id="gapInput" type="number" value="50" min="0">
  </label>
</div>

<script>
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const grid = document.getElementById("grid");
const playBtn = document.getElementById("playSequence");
const cutoffInput = document.getElementById("cutoffInput");
const gapInput = document.getElementById("gapInput");
const genreButtonsDiv = document.getElementById("genreButtons");

const rates = [1,2,3,4];
const pads = [];

// ---- GENRE LAYOUTS ----
const layouts = {
  dnb:["Crash","Ride","Open Hat","FX","Closed Hat","Clap","Snare","Rim","Kick","Kick Alt","Tom Low","Tom Mid","Tom High","Perc","Perc Alt","FX"],
  techno:["Crash","Ride","Open Hat","Noise","Closed Hat","Clap","Snare","Rim","Kick","Kick Sub","Kick Dist","Tom","Perc","Metal","FX","FX"],
  lofi:["Vinyl","Texture","Open Hat","FX","Soft Hat","Clap","Snare","Rim","Soft Kick","Low Kick","Tom","Tom","Perc","Shaker","Chord","Vocal"],
  jungle:["Crash","Ride","Open Hat","FX","Closed Hat","Snare","Ghost","Rim","Kick","Kick Alt","Tom Low","Tom Mid","Tom High","Amen","Perc","FX"],
  ambient:["Pad1","Pad2","Pad3","FX","Soft Hat","Bell","Snare","Rim","Kick","Kick Low","Tom","Tom","Texture","Texture","FX","FX"],
  trap:["Crash","Ride","Open Hat","FX","Closed Hat","Clap","Snare","Rim","808","Kick Alt","Tom","Tom","Hi Tom","Perc","FX","Vocal"],
  breakbeat:["Crash","Ride","Open Hat","FX","Closed Hat","Clap","Snare","Alt Sn","Kick","Kick Alt","Tom","Tom","Hi Tom","Perc","FX","FX"],
  hiphop:["Crash","Ride","Open Hat","FX","Closed Hat","Clap","Snare","Rim","Kick","Low Kick","Tom","Tom","Perc","Perc2","FX","Vocal"],
  house:["Crash","Ride","Open Hat","FX","Closed Hat","Clap","Snare","Rim","Kick","Sub","Alt Kick","Tom","Perc","Hi Tom","FX","FX"]
};

// ---- CREATE PADS ----
function createPad(i){
  const el=document.createElement("div");
  el.className="pad";

  const rateEl=document.createElement("div");
  rateEl.className="rate";
  el.appendChild(rateEl);

  const labelEl=document.createElement("div");
  el.appendChild(labelEl);

  grid.appendChild(el);

  const fileInput=document.createElement("input");
  fileInput.type="file";
  fileInput.accept="audio/*";
  fileInput.style.display="none";
  fileInput.onchange=e=>{
    if(e.target.files[0]) loadSample(e.target.files[0],i);
  };
  el.appendChild(fileInput);

  pads[i]={ buffer:null, rate:1, el, rateEl, labelEl, name:"" };

  let holdTimer=null;

  el.onmousedown=()=>{
    holdTimer=setTimeout(()=>fileInput.click(),500);
  };
  el.onmouseup=()=>{
    if(holdTimer){
      clearTimeout(holdTimer);
      playPad(i);
    }
    holdTimer=null;
  };
  el.onmouseleave=()=>holdTimer && clearTimeout(holdTimer);

  el.oncontextmenu=e=>{
    e.preventDefault();
    cycleRate(i);
  };

  el.ondragover=e=>e.preventDefault();
  el.ondrop=e=>{
    e.preventDefault();
    loadSample(e.dataTransfer.files[0],i);
  };
}

// ---- GENRE BUTTONS ----
Object.keys(layouts).forEach(g=>{
  const b=document.createElement("button");
  b.textContent=g.toUpperCase();
  b.onclick=()=>setLayout(g);
  genreButtonsDiv.appendChild(b);
});

function setLayout(g){
  document.querySelectorAll(".buttons button").forEach(b=>b.classList.remove("selected"));
  [...genreButtonsDiv.children].find(b=>b.textContent===g.toUpperCase()).classList.add("selected");

  layouts[g].forEach((name,i)=>{
    pads[i].name=name;
    updatePadLabel(i);
  });
}

// ---- PAD LABEL ----
function updatePadLabel(i){
  const p=pads[i];
  p.rateEl.textContent=p.rate+"x";

  let text=p.name;
  if(p.buffer){
    text+=`\n${getPadDuration(p).toFixed(2)}s`;
  }
  p.labelEl.textContent=text;
}

// ---- LOAD SAMPLE ----
async function loadSample(file,i){
  const data=await file.arrayBuffer();
  const buffer=await audioCtx.decodeAudioData(data);
  const p=pads[i];
  p.buffer=buffer;
  p.el.classList.add("loaded");
  updatePadLabel(i);
  updateSequenceDuration();
}

// ---- RATE ----
function cycleRate(i){
  const p=pads[i];
  p.rate=rates[(rates.indexOf(p.rate)+1)%rates.length];
  updatePadLabel(i);
  updateSequenceDuration();
}

// ---- DURATION ----
function getPadDuration(p){
  if(!p.buffer) return 0;
  const cutoff=parseFloat(cutoffInput.value);
  const raw=p.buffer.duration / p.rate;
  return cutoff>0 ? Math.min(cutoff/1000, raw) : raw;
}

// ---- PLAY PAD ----
function playPad(i){
  const p=pads[i];
  if(!p.buffer) return;
  const src=audioCtx.createBufferSource();
  src.buffer=p.buffer;
  src.playbackRate.value=p.rate;
  src.connect(audioCtx.destination);
  src.start();
  src.stop(audioCtx.currentTime+getPadDuration(p));

  p.el.classList.add("playing");
  setTimeout(()=>p.el.classList.remove("playing"),100);
}

// ---- SEQUENCE ----
function playSequence(){
  let t=audioCtx.currentTime;
  const gap=parseFloat(gapInput.value)/1000;

  pads.forEach(p=>{
    if(!p.buffer) return;
    const src=audioCtx.createBufferSource();
    src.buffer=p.buffer;
    src.playbackRate.value=p.rate;
    src.connect(audioCtx.destination);

    const dur=getPadDuration(p);
    src.start(t);
    src.stop(t+dur);
    t+=dur+gap;
  });
}

// ---- TOTAL TIME ----
function updateSequenceDuration(){
  const gap=parseFloat(gapInput.value)/1000;
  let total=0;
  pads.forEach(p=>{
    if(!p.buffer) return;
    total+=getPadDuration(p)+gap;
  });
  playBtn.textContent=`Play All (${total.toFixed(2)}s)`;
}

// ---- COUNTDOWN ----
async function countdownAndPlay(){
  if(playBtn.disabled) return;
  playBtn.disabled=true;
  for(let i=3;i>0;i--){
    playBtn.textContent=i+"â€¦";
    await new Promise(r=>setTimeout(r,1000));
  }
  playBtn.textContent="PLAYING";
  playSequence();
  setTimeout(()=>{
    playBtn.disabled=false;
    updateSequenceDuration();
  },100);
}

playBtn.onclick=countdownAndPlay;
cutoffInput.oninput=updateSequenceDuration;
gapInput.oninput=updateSequenceDuration;

// ---- INIT ----
for(let i=0;i<16;i++) createPad(i);
setLayout("dnb");
updateSequenceDuration();
</script>

</body>
</html>
